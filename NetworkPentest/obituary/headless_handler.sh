#!/bin/bash

tmp=$(mktemp)

handle_file() {
  local screenname=$(echo $tmp | cut -d'.' -f 2-)

  screen -S $screenname -dm sh -c "cd $(dirname $(realpath $tmp)); vim $tmp"
  sleep 5
  screen -S $screenname -X stuff ":q! $(echo -ne '\r')"
  sleep 1
  rm $tmp
}

cat > $tmp
handle_file & disown
